/*!Chatpi V0.1 
 A cheap portable chat server 
Minified on: 16-03-2015 */
function setMessage(content){$("#login-message").text(content),$("#login-message").css({display:"inline-block"})}function validate(input){var reg=/^[a-z0-9]+$/i;return input.length>=4&&null!==input&&""!==input&&reg.test(input)?!0:(setMessage("The username/password must be at least 4 characters long"),!1)}function login(){var username=$("#username-input").val(),password=$("#password-input").val();return validate(username)&&validate(password)?(socket.emit("login",{username:username,password:password}),void socket.on("login_status",function(status){return status?(window.location.replace("app.html"),!0):(setMessage("Sorry... Incorrect login"),!1)})):!1}var socket=io(),selfName="",selfUsername="";socket.on("metadata",function(data){selfName=data.clientName,selfUsername=data.clientUsername,selfProfilePicture=data.clientProfilePic});var ChatPiApp=angular.module("ChatPiApp",[]);ChatPiApp.factory("Message",function(){var Message=function(contents,type){this.contents=contents,this.type=type};return Message}),ChatPiApp.service("getDate",function(){this.currentDateInMinutes=function(){return Math.ceil(Date.now()/1e3/60)}}),ChatPiApp.filter("dateParser",function(){return function(messageDate,currentDate){var differenceInMinutes=currentDate-messageDate;return 1>differenceInMinutes?"less than a minute ago":1==differenceInMinutes?"1 minute ago":60>differenceInMinutes?differenceInMinutes+" minutes ago":120>differenceInMinutes?"1 hour ago":1440>differenceInMinutes?Math.round(differenceInMinutes/60)+" hours ago":2880>differenceInMinutes?"1 day ago":10080>differenceInMinutes?Math.round(differenceInMinutes/60/24)+"days ago":messageDate.toLocaleDateString()}}),ChatPiApp.controller("Conversation",function($scope,Message,getDate){$scope.getDateInMinutes=getDate.currentDateInMinutes,$scope.conversation={message_history:[],new_message:""},$scope.send=function(){var cleanMessage=$scope.conversation.new_message.replace(/\s/g,"");if(""!==cleanMessage){var message=new Message($scope.conversation.new_message,"text");socket.emit("message",message),$scope.conversation.new_message=""}},socket.on("message",function(msg){msg.self=msg.senderUsername==selfUsername?"self":"",$scope.$apply($scope.conversation.message_history.push(msg))}),setInterval(function(){$scope.$apply()},6e4)}),socket.on("disconnect",function(){console.log("disconnected")}),socket.on("error",function(msg){console.error("An error occured with the connection to the chat server \n"+msg)});var socket=io();